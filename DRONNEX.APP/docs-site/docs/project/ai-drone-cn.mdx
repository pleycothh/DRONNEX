---
sidebar_position: 3
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# AI Drone (Chinese)
# AI æ— äººæœº

## ç®€ä»‹
AI æ— äººæœºï¼Œ é€šè¿‡æœºè½½ç”µè„‘ å®ç°è¾¹ç¼˜AIè¿ç®—ã€‚ è®©æ— äººæœºå¯ä»¥è‡ªä¸»é£è¡Œï¼Œå¹¶ä¸”é€šè¿‡AIå®æ—¶æ§åˆ¶å’Œè°ƒæ•´é£æœºä½œä¸šã€‚å¤–åŠ åœ°é¢ç«™å®æ—¶åé¦ˆã€‚


# æå‰å‡†å¤‡
 - å¯ä»¥å®‰è£… [Ardupilot](https://ardupilot.org/) çš„ [é£æ§](https://ardupilot.org/copter/docs/common-autopilots.html)
 - æ— äººæœº
 - æœºè½½ç”µè„‘
 - æ‘„åƒå¤´
 - åœ°é¢ç«™ ï¼ˆ ç¬”è®°æœ¬ç”µè„‘ï¼‰
 
 # ç¬¬ä¸€æ­¥ ï¼š å‡†å¤‡æ— äººæœº | Setup the Drone
    :::caution
        ä¸Šç”µå‰ï¼Œè¯· åŠ¡å¿…ç§»é™¤èºæ—‹æ¡¨ï¼
        Remove all propellers before powering on for safety.
    :::
- å‡†å¤‡ä¸€å¥— ArduPilot æ”¯æŒçš„é£æ§ï¼ˆå¦‚ Pixhawk 6Cï¼‰
- ç»„è£…å¥½ç”µè°ƒã€ç”µæœºã€é£æ§ã€GPSã€é¥æ§æ¥æ”¶å™¨ç­‰
- è¿æ¥ç”µæºæ¨¡å—ï¼ˆå¦‚ Holybro PM02Dï¼‰ç¡®ä¿å®‰å…¨ä¾›ç”µ
- é£æ§åˆå§‹åŒ–é…ç½®ï¼š
  - ä½¿ç”¨ Ardupilot [é£æ§è®¾ç½®](https://ardupilot.org/copter/docs/initial-setup.html)
  - è®¾ç½®é£è¡Œæ¨¡å¼ã€æ ¡å‡†é¥æ§å™¨ã€åŠ é€Ÿåº¦è®¡ã€æŒ‡å—é’ˆã€GPS ç­‰ 

# ç¬¬äºŒæ­¥ï¼š å‡†å¤‡æœºè½½ç”µè„‘ | Prepare the Onboard Computer
**å®‰è£…ç³»ç»Ÿ:**
<Tabs>
  <TabItem value="c" label="æ ‘è“æ´¾" default>
    ä½¿ç”¨ Raspberry Pi Imager [å®‰è£…ç³»ç»Ÿ](https://www.raspberrypi.com/documentation/computers/getting-started.html)
    å»ºè®®é€‰æ‹© 64-bitï¼Œæ— æ¡Œé¢ç‰ˆæœ¬: `Rasbarry Pi OS Lite (64-bit)`
    âš™ï¸ è®¾ç½®æ—¶å¯ç”¨ SSH, WIFIï¼Œ å’Œæ‘„åƒå¤´
  </TabItem>
  <TabItem value="d" label="ç‘è">
    å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šROCK 5C [å¿«é€Ÿå¼€å§‹](https://docs.radxa.com/rock5/rock5c/getting-started)
    æ¨èç³»ç»Ÿï¼šDebian Bookworm æˆ– Ubuntu Server
    </TabItem>
</Tabs>
**ğŸ› ï¸ç³»ç»Ÿå‡†å¤‡å¿…è¦å·¥å…·ï¼š**
    ```jsx title="bash"
    sudo apt update && sudo apt upgrade -y
    sudo apt install -y git python3-pip python3-venv python3-opencv
    sudo apt install -y libatlas-base-dev libjpeg-dev libtiff5-dev libqtgui4 libqt4-test
    ```

**é…ç½®æ‘„åƒå¤´ï¼š**

<Tabs>
    <TabItem value="c" label="æ ‘è“æ´¾" default>
        ```jsx title="bash"
        # å¯ç”¨æ‘„åƒå¤´ã€SSHã€è·³è¿‡GUIç™»å½•ã€å¯ç”¨I2C/UARTç­‰
        sudo raspi-config
        ```
    </TabItem>
    <TabItem value="d" label="ç‘è">
        ```jsx title="bash"
        # å¯ç”¨Radxa Camera 4K æ‘„åƒå¤´
        radxa@rock-5c:~$ rsetup 

        # é¢„è§ˆ
        gst-launch-1.0 v4l2src device=/dev/video11 io-mode=4 ! videoconvert ! video/x-raw,format=NV12,width=1920,height=1080 ! xvimagesink;
        
        # æ‹ç…§
        gst-launch-1.0 v4l2src device=/dev/video11 io-mode=4 ! videoconvert ! video/x-raw,format=NV12,width=1920,height=1080 ! jpegenc ! multifilesink location=file.name.jpg;
        
        # æ‹æ‘„è§†é¢‘
        gst-launch-1.0 v4l2src num-buffers=512 device=/dev/video11 io-mode=4 ! videoconvert ! video/x-raw, format=NV12, width=1920, height=1080, framerate=30/1 ! tee name=t ! queue ! mpph264enc ! queue ! h264parse ! mpegtsmux ! filesink location=/home/radxa/file.name.mp4
        ```
    </TabItem>
</Tabs>

# ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡åœ°é¢ç«™ 
1. å®‰è£… Ardupilot åœ°é¢ç«™ [Mission Planning](https://ardupilot.org/copter/docs/common-mission-planning.html) ï¼ˆå¯é€‰ï¼‰
2. å®‰è£… Linux ç³»ç»Ÿï¼Œ è¿™é‡Œæ¨èåœ¨Windowsä¸‹å®‰è£… [WSL](https://learn.microsoft.com/en-us/windows/wsl/install)
 
# ç¬¬å››æ­¥ æµ‹è¯•äººä½“è¯†åˆ«
å®‰è£… OpenCVï¼ˆå¦‚æœªå®‰è£…ï¼‰ï¼š
```jsx title="bash"
    pip install opencv-python
```
è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
<Tabs>
    <TabItem value="c" label="OpenCV" default>
        ```jsx title="Pi OS Lite (64-bit)"
        # face_detect.py ç¤ºä¾‹
            import cv2

            cap = cv2.VideoCapture(0)
            while True:
                ret, frame = cap.read()
                if not ret:
                    break
                gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
                face_cascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')
                faces = face_cascade.detectMultiScale(gray, 1.3, 5)
                for (x, y, w, h) in faces:
                    cv2.rectangle(frame, (x, y), (x+w, y+h), (255, 0, 0), 2)
                cv2.imshow('Face', frame)
                if cv2.waitKey(1) & 0xFF == ord('q'):
                    break
            cap.release()
            cv2.destroyAllWindows()
        ```
    </TabItem>
    <TabItem value="d" label="Yolo11n bash">
        ```jsx title="bash"
        pip3 install -U ultralytics
        yolo predict model='./yolo11n_rknn_model' source='https://ultralytics.com/images/bus.jpg'
        ```
    </TabItem>
</Tabs>
 
# ç¬¬äº”æ­¥ï¼š è¿æ¥é£æ§ä¸æœºè½½ç”µè„‘ | Connect Flight Controller to Computer via MAVLink
 0. å®‰è£…è™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
    ä¸ºäº†éš”ç¦»ä¾èµ–ï¼Œä½¿ç”¨ Python è™šæ‹Ÿç¯å¢ƒè¿è¡Œ MAVLink è„šæœ¬ï¼š
    ```jsx title="bash"
        sudo apt update
        sudo apt install -y python3-venv python3-pip

        # åˆ›å»ºå¹¶è¿›å…¥è™šæ‹Ÿç¯å¢ƒ
        python3 -m venv ~/mav-env
        source ~/mav-env/bin/activate

        # å®‰è£… MAVLink ç›¸å…³åŒ…
        pip install pymavlink MAVProxy
    ```

 1. ç¡®å®šMavProxyå·¥å…·åŒ…å·²ç»å®‰è£…
    ```jsx title="bash"
    mavproxy.py --version
    ```
    æˆ–åœ¨ Python ä¸­æµ‹è¯•ï¼š
    ```jsx title="python"
    from pymavlink import mavutil
    print("âœ… pymavlink installed")
    ```
 2. ç¡®å®šæ­£ç¡®æ¥çº¿:
    - é£æ§ TX â†’ USB è½¬ä¸²å£çš„ RX
    - é£æ§ RX â†’ USB è½¬ä¸²å£çš„ TX
    - æ³¢ç‰¹ç‡å»ºè®®ä½¿ç”¨ï¼š57600, 115200, æˆ– 921600
    - æŸ¥çœ‹ä¸²å£å·ï¼š
    ```jsx title="bash"
        ls /dev/ttyACM*     # USB ç›´è¿
        ls /dev/serial0     # GPIO UART
    ```

 3. æ£€æµ‹æ˜¯å¦è¿æ¥æˆåŠŸ
    - æŸ¥çœ‹é£æ§è¿æ¥ï¼š
    ```jsx title="bash"
    ls /dev/ttyACM*
    ```
    - ä½¿ç”¨ MAVProxy æµ‹è¯•ï¼š
    ```jsx title="bash"
    mavproxy.py --master=/dev/ttyACM0 --baudrate 115200 --aircraft test-drone
    ```
    - å‡ºç°å¦‚ä¸‹è¾“å‡ºè¡¨ç¤ºè¿æ¥æˆåŠŸï¼š
    ```jsx title="bash"
    Waiting for heartbeat from /dev/ttyACM0
    MAV>   
    ```


 4. è¿æ¥ååœ¨ MAVProxy æ§åˆ¶å°è¾“å…¥å‘½ä»¤ï¼š
    ```jsx title="bash"
        status         # æŸ¥çœ‹é£æ§çŠ¶æ€ï¼ˆæ¨¡å¼ã€ç”µå‹ã€GPSã€RC è¾“å…¥ç­‰ï¼‰
        gpsstatus      # æŸ¥çœ‹ GPS å«æ˜Ÿæ•°é‡ä¸ä½ç½®
        rc             # å®æ—¶æŸ¥çœ‹é¥æ§å™¨å„é€šé“å€¼
        param show     # æŸ¥çœ‹é£æ§å‚æ•°
    ```
 5. ç®€å•é€šè¿‡ç”µè„‘æ§åˆ¶é£æ§
    ```jsx title="Mavlink"
        # è§£é”ç”µæœº
        arm throttle

        # é”å®šç”µæœº
        disarm throttle

        # æŸ¥çœ‹ç”µå‹ã€ç”µæµã€ç”µæºçŠ¶æ€
        battery

        # æŸ¥çœ‹å½“å‰ GPS ä½ç½®
        gpsstatus

        # è®¾ç½®æ¨¡å¼ï¼ˆå¦‚ï¼šå®šé«˜ã€å·¡èˆªï¼‰
        mode ALT_HOLD
        mode GUIDED

        # è®¾ç½®å‚æ•°ï¼ˆä¾‹å¦‚ï¼šå…³é—­ ARM æ£€æŸ¥ï¼‰
        param set ARMING_CHECK 0

        # æ§åˆ¶ç‰¹å®šé€šé“è¾“å‡ºï¼ˆæµ‹è¯•é©¬è¾¾æ—‹è½¬ï¼‰
        servo set 1 1700
        servo set 2 1500

        # ä¿å­˜å½“å‰å‚æ•°
        param save
    ```
 
# ç¬¬å…­æ­¥ï¼š è·å– GPS æ•°æ®
åœ¨äººè„¸è¯†åˆ«è„šæœ¬ä¸­æ·»åŠ è·å– GPS åæ ‡ï¼š
    ```jsx title="python"
        from pymavlink import mavutil

        # è¿æ¥é£æ§
        master = mavutil.mavlink_connection('/dev/ttyACM0', baud=115200)
        master.wait_heartbeat()

        # è·å– GPS ä¿¡æ¯
        msg = master.recv_match(type='GLOBAL_POSITION_INT', blocking=True)
        lat = msg.lat / 1e7
        lon = msg.lon / 1e7
    ```
# ç¬¬ä¸ƒæ­¥ï¼šä¿å­˜å›¾åƒå¹¶è®°å½•æ•°æ®
ç¤ºä¾‹é€»è¾‘ï¼š
æ£€æµ‹åˆ°äººè„¸æ—¶

ä¿å­˜å›¾åƒ ~/captures/YYYY-MM-DD_HH-MM-SS.jpg

è®°å½•å½“å‰ GPS ä¸æ—¶é—´æˆ³è‡³ CSV

ç¤ºä¾‹ä»£ç ç‰‡æ®µï¼š
```jsx title="python"
    import csv
    from datetime import datetime

    def log_data(lat, lon):
        with open('~/log/location.csv', 'a') as f:
            writer = csv.writer(f)
            timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            writer.writerow([timestamp, lat, lon])
```